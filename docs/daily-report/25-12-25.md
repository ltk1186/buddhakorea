# Daily Report: 2025-12-25

## Pali Studio 프로덕션 배포

### 1. 배포 준비 및 코드 수정

#### docker-compose.yml 수정

- **문제**: DPD 경로가 로컬 절대 경로로 하드코딩되어 서버에서 작동하지 않음
- **수정**: `/Users/vairocana/Desktop/nikaya_gemini/data/dpd` → `../data/dpd`
- **파일**: `config/docker-compose.yml:94`

#### .gitignore 업데이트

- `node_modules/` 및 `**/node_modules/` 추가 (157MB 방지)

#### 오래된 빌드 파일 정리

- `frontend/pali/assets/`에서 28개의 오래된 빌드 파일 삭제
- 현재 빌드 파일만 유지: `index-EqlPmuhA.js`, `index-B0O51P70.css`

### 2. 서버 데이터 준비

#### DPD 데이터베이스 업로드

- **파일**: `dpd.db` (2.0GB)
- **경로**: `/opt/buddha-korea/data/dpd/dpd.db`
- **방법**: `scp`로 로컬에서 서버로 직접 전송

#### PostgreSQL 데이터 마이그레이션

1. 테이블 생성: `literatures`, `segments` 테이블이 서버 DB에 없어서 500 에러 발생
2. 해결: `Base.metadata.create_all(bind=engine)` 실행
3. 데이터 이전:
   - 로컬 DB에서 덤프: `pg_dump -t literatures -t segments --data-only`
   - 서버로 전송 및 임포트: 18,673행

### 3. 배포 실행

```bash
# Git 커밋 및 푸시
git add -A
git commit -m "feat: Pali Studio UI 개선 및 배포 준비"
git push origin feature/pali-studio-integration

# 서버 배포
ssh root@157.180.72.0 "cd /opt/buddha-korea && git pull origin feature/pali-studio-integration"
ssh root@157.180.72.0 "cd /opt/buddha-korea/config && docker compose down && docker compose up -d --build"
```

### 4. 배포 결과

#### 컨테이너 상태

| 컨테이너             | 상태    |
| -------------------- | ------- |
| buddhakorea-backend  | healthy |
| buddhakorea-nginx    | healthy |
| buddhakorea-postgres | healthy |
| buddhakorea-redis    | healthy |

#### API 검증

- Health check: `{"status":"healthy","version":"0.1.0","chroma_connected":true,"llm_configured":true}`
- Pali Studio: HTTP 200 OK
- Literature API: 47개 문헌 정상 로드

### 5. 문헌 명명 규칙 검토

#### 약어 (Abbreviation) 검토

| 약어  | 설명                        | 상태   |
| ----- | --------------------------- | ------ |
| AN-a  | Aṅguttara Nikāya Aṭṭhakathā | 올바름 |
| DN-a  | Dīgha Nikāya Aṭṭhakathā     | 올바름 |
| MN-a  | Majjhima Nikāya Aṭṭhakathā  | 올바름 |
| SN-a  | Saṃyutta Nikāya Aṭṭhakathā  | 올바름 |
| Vin-a | Vinaya Aṭṭhakathā           | 올바름 |
| Dhp-a | Dhammapada Aṭṭhakathā       | 올바름 |
| Ja-a  | Jātaka Aṭṭhakathā           | 올바름 |

#### 한글 음역 검토 (일부 불일치)

| 빠알리       | 현재       | 표준         |
| ------------ | ---------- | ------------ |
| Ekakanipāta  | 에까니빠따 | 에까까니빠따 |
| Vimanavatthu | 비마나왓투 | 위마나왓투   |
| Jātaka       | 자타까     | 자따까       |

### 6. UX 검토: 헤더 구조

#### 현재 구조 (2-헤더)

1. SiteHeader: Buddha Korea 로고 | 빠알리 스튜디오 | 홈/AI/빠알리/사경
2. Header: 햄버거 | 빠알리 스튜디오 | 문헌선택 | 검색 | 설정 | 질문

#### 1-헤더 통합 제안 검토

- **Buddhist UX Reviewer 결론**: 현재 2-헤더 구조 유지 권장
- **이유**:
  - 경전 번역은 명상적 몰입이 필요한 작업
  - SiteHeader가 스크롤시 숨겨지는 것이 "번역 전용 공간" 경계를 형성
  - 1-헤더로 합치면 항상 "나가기" 옵션이 시야에 남아 집중 방해

---

## 기술적 컨텍스트

### 서버 정보

- **IP**: 157.180.72.0 (Hetzner)
- **도메인**: ai.buddhakorea.com
- **배포 경로**: `/opt/buddha-korea/`

### 주요 파일 경로

```
/opt/buddha-korea/
├── config/
│   ├── docker-compose.yml
│   ├── nginx.conf
│   └── redis.conf
├── data/
│   ├── chroma_db/          # 벡터 DB
│   ├── dpd/                 # Digital Pali Dictionary (2GB)
│   └── source_data/         # 경전 데이터
├── backend/
│   └── pali/               # Pali Studio 백엔드
└── frontend/
    └── pali/               # Pali Studio 프론트엔드 (빌드됨)
```

### 데이터베이스 스키마

```sql
-- Pali Studio 테이블
literatures (47개 문헌)
  - id, name, pali_name, pitaka, nikaya, status
  - total_segments, translated_segments
  - hierarchy_labels, display_metadata

segments (18,000+ 세그먼트)
  - id, literature_id, segment_number
  - pali_text, korean_translation
  - hierarchy_path, page_number
```

---

## 다음 작업 예정

0. Cloudflare CDN
1. change sub-domain to directory based
2. 문헌 명명 규칙 통일 (한글 음역 표준화)
3. SiteHeader "빠알리 스튜디오" 중복 텍스트 제거 검토
4. 번역 진행률 표시 UI 개선 (문헌 컨텍스트 내부 통합)

## 노트

1. /pali 링크 해더에 AI를 누르면 연결 안됨.
2. VM에서 번역한 세그먼트 데이터를 어떻게 로컬과 연동시키는지 (로컬 개발 때 백엔드를 서버로 써야 하나? 그러면 백앤드 개발은 어떻게 하지? DB만 서버를 쓰나?)
