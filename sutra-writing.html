<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì „ì ì‚¬ê²½ | Buddha Korea</title>
    <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/sutra.css">
</head>
<body>
    <!-- ì ‘ê·¼ì„±: ê±´ë„ˆë›°ê¸° ë§í¬ -->
    <a href="#screen-select" class="skip-link">ì‚¬ê²½ ì„ íƒìœ¼ë¡œ ê±´ë„ˆë›°ê¸°</a>

    <!-- í—¤ë” -->
    <header class="site-header">
        <div class="header-container">
            <a href="index.html" class="header-logo">
                <img src="assets/buddha-line.png" alt="Buddha Korea" class="logo-icon">
                <span class="logo-text">Buddha Korea</span>
            </a>
            <nav class="header-nav">
                <a href="index.html" class="nav-link">í™ˆ</a>
                <a href="https://ai.buddhakorea.com" class="nav-link">AI</a>
                <a href="sutra-writing.html" class="nav-link">ì‚¬ê²½</a>
            </nav>
        </div>
    </header>
    <div class="header-spacer"></div>

    <!-- ë§ˆìš°ìŠ¤ ë”°ë¼ë‹¤ë‹ˆëŠ” ë¹› íš¨ê³¼ -->
    <div class="mouse-light"></div>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="sutra-page">

        <!-- 1. ê²½ì „ ì„ íƒ í™”ë©´ -->
        <div id="screen-select" class="screen show">
            <div class="center-box">
                <h1>ì „ì ì‚¬ê²½</h1>
                <p class="subtitle">í•œ ê¸€ì í•œ ê¸€ì ì •ì„±ìŠ¤ëŸ½ê²Œ íƒ€ì´í•‘í•˜ë©° ë§ˆìŒì„ ê°€ë‹¤ë“¬ëŠ” ìˆ˜í–‰</p>

                <!-- Category tabs -->
                <div class="category-tabs" role="tablist" aria-label="ì‚¬ê²½ ì¹´í…Œê³ ë¦¬">
                    <button class="tab-btn active"
                            role="tab"
                            aria-selected="true"
                            aria-controls="sutra-card-container"
                            data-category="all">
                        ì „ì²´
                    </button>
                    <button class="tab-btn"
                            role="tab"
                            aria-selected="false"
                            aria-controls="sutra-card-container"
                            data-category="sutra">
                        ê²½ì „
                    </button>
                    <button class="tab-btn"
                            role="tab"
                            aria-selected="false"
                            aria-controls="sutra-card-container"
                            data-category="mantra">
                        ì§„ì–¸
                    </button>
                    <button class="tab-btn"
                            role="tab"
                            aria-selected="false"
                            aria-controls="sutra-card-container"
                            data-category="name">
                        ëª…í˜¸
                    </button>
                    <button class="tab-btn"
                            role="tab"
                            aria-selected="false"
                            aria-controls="sutra-card-container"
                            data-category="verse">
                        ê²Œì†¡
                    </button>
                </div>

                <!-- Dynamic sutra cards container -->
                <div id="sutra-card-container"
                     class="sutra-cards"
                     role="tabpanel"
                     aria-live="polite"
                     aria-atomic="false">
                    <!-- Cards will be dynamically generated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- 2. ì‚¬ê²½ ì‘ì„± í™”ë©´ -->
        <div id="screen-write" class="screen">
            <div class="write-container">
                <button class="back-btn" onclick="goBack()" aria-label="ê²½ì „ ì„ íƒ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°">â† ëŒì•„ê°€ê¸°</button>

                <h2 id="sutra-name" class="sutra-name">ìì• ê²½</h2>

                <!-- ëª¨ë“œ ì„ íƒ -->
                <div class="mode-selector" role="radiogroup" aria-label="ì‚¬ê²½ ëª¨ë“œ ì„ íƒ">
                    <button class="mode-btn active"
                            role="radio"
                            aria-checked="true"
                            data-mode="traditional"
                            aria-label="ì „í†µ ëª¨ë“œ: ì—„ê²©í•œ ê²€ì¦ìœ¼ë¡œ í•œ ê¸€ìì”© ì •í™•íˆ íƒ€ì´í•‘">
                        <span class="mode-icon">ğŸ“¿</span>
                        <span class="mode-label">ì „í†µ ëª¨ë“œ</span>
                        <span class="mode-desc">ì •í™•í•œ íƒ€ì´í•‘</span>
                    </button>
                    <button class="mode-btn"
                            role="radio"
                            aria-checked="false"
                            data-mode="easy"
                            aria-label="í¸ì•ˆí•œ ëª¨ë“œ: í´ë¦­ìœ¼ë¡œ ì´ë™, ë”ë¸”ìŠ¤í˜ì´ìŠ¤ë¡œ ì¤„ ì™„ì„±">
                        <span class="mode-icon">ğŸŒ¸</span>
                        <span class="mode-label">í¸ì•ˆí•œ ëª¨ë“œ</span>
                        <span class="mode-desc">í´ë¦­ ì´ë™ & ìë™ ì™„ì„±</span>
                    </button>
                </div>

                <!-- ëª¨ë“œ íŒíŠ¸ (Easy Modeì—ì„œë§Œ í‘œì‹œ) -->
                <div id="mode-hint" class="mode-hint" style="display: none;">
                    <span class="hint-icon">ğŸ’¡</span>
                    <span class="hint-text">
                        ì›í•˜ëŠ” ê¸€ìë¥¼ <strong>í´ë¦­</strong>í•˜ì—¬ ì´ë™í•˜ê±°ë‚˜,
                        <strong>ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ë‘ ë²ˆ</strong> ëˆŒëŸ¬ ì¤„ì„ ì™„ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                    </span>
                </div>

                <!-- íƒ€ì´í•‘ ë°•ìŠ¤ -->
                <div class="type-box" role="region" aria-label="ì‚¬ê²½ ì‘ì„± ì˜ì—­">
                    <div id="text-bg" class="text-bg" aria-live="polite" aria-atomic="false"></div>
                    <!-- Traditional Mode: Textarea -->
                    <textarea id="text-input" class="text-input"
                              aria-label="ê²½ì „ íƒ€ì´í•‘ ì…ë ¥ì°½"
                              aria-describedby="sutra-name"></textarea>
                    <!-- Easy Mode: Contenteditable -->
                    <div id="text-input-easy" class="text-input-easy"
                         contenteditable="true"
                         spellcheck="false"
                         aria-label="ê²½ì „ íƒ€ì´í•‘ ì…ë ¥ì°½ (í¸ì•ˆí•œ ëª¨ë“œ)"
                         aria-describedby="sutra-name"
                         style="display: none;"></div>
                </div>

                <!-- íšŒí–¥ ë²„íŠ¼ë“¤ (ì™„ì„± í›„ ë‚˜íƒ€ë‚¨) -->
                <div id="dedication-box" class="dedication-box" role="region" aria-labelledby="dedication-heading">
                    <h3 id="dedication-heading">ê³µë•ì„ íšŒí–¥í•©ë‹ˆë‹¤</h3>
                    <p>ì´ ìˆ˜í–‰ì˜ ê³µë•ì„ ëª¨ë“  ì¤‘ìƒê³¼ í•¨ê»˜ ë‚˜ëˆ•ë‹ˆë‹¤</p>

                    <!-- Typing statistics (shown in Easy Mode) -->
                    <div id="typing-stats" class="typing-stats" style="display: none;">
                        <div class="stat-item">
                            <span class="stat-label">ì§ì ‘ íƒ€ì´í•‘</span>
                            <span class="stat-value" id="typed-count">0ì (0%)</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">ìë™ ì™„ì„±</span>
                            <span class="stat-value" id="skipped-count">0ì (0%)</span>
                        </div>
                    </div>

                    <div class="realm-buttons">
                        <button onclick="dedicate('hell')" aria-label="ì§€ì˜¥ ì¤‘ìƒì—ê²Œ ê³µë• íšŒí–¥">ì§€ì˜¥ ì¤‘ìƒ</button>
                        <button onclick="dedicate('animal')" aria-label="ì¶•ìƒì—ê²Œ ê³µë• íšŒí–¥">ì¶•ìƒ</button>
                        <button onclick="dedicate('hungry-ghost')" aria-label="ì•„ê·€ì—ê²Œ ê³µë• íšŒí–¥">ì•„ê·€</button>
                        <button onclick="dedicate('asura')" aria-label="ì•„ìˆ˜ë¼ì—ê²Œ ê³µë• íšŒí–¥">ì•„ìˆ˜ë¼</button>
                        <button onclick="dedicate('human')" aria-label="ì¸ê°„ì—ê²Œ ê³µë• íšŒí–¥">ì¸ê°„</button>
                        <button onclick="dedicate('deva')" aria-label="ì²œì‹ ì—ê²Œ ê³µë• íšŒí–¥">ì²œì‹ </button>
                        <button class="primary" onclick="dedicate('all')" aria-label="ì¼ì²´ ì¤‘ìƒì—ê²Œ ê³µë• íšŒí–¥">ì¼ì²´ ì¤‘ìƒ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. íšŒí–¥ ì™„ë£Œ í™”ë©´ -->
        <div id="screen-dedication-complete" class="screen">
            <div class="center-box">
                <h2 class="dedication-complete-text">íšŒí–¥ ì™„ë£Œ</h2>
            </div>
        </div>

    </div>

    <!-- Floating Feedback Button (only visible on selection screen) -->
    <button class="fab fab-sutra" onclick="openFeedbackModal()" aria-label="í”¼ë“œë°± ë‚¨ê¸°ê¸°">
        <span class="fab-icon">ğŸ’¬</span>
        <span class="fab-text">í”¼ë“œë°±</span>
    </button>

    <script type="module">
        import { getSutrasByCategory, getCategoryLabel, dataLoadedPromise } from './js/sutra-data.js';

        // Render sutra cards based on category filter
        function renderSutraCards(category = 'all') {
            const container = document.getElementById('sutra-card-container');
            const sutras = getSutrasByCategory(category);

            // Clear existing cards
            container.innerHTML = '';

            // Create fragment for better performance
            const fragment = document.createDocumentFragment();

            sutras.forEach(sutra => {
                const card = document.createElement('div');
                card.className = 'card';
                card.setAttribute('role', 'button');
                card.setAttribute('tabindex', '0');
                card.setAttribute('aria-label', `${sutra.title} ì„ íƒ: ${sutra.description}`);

                // Event handlers
                card.onclick = () => window.selectSutra(sutra.id);
                card.onkeypress = (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        window.selectSutra(sutra.id);
                    }
                };

                // Card content
                card.innerHTML = `
                    <h2>
                        ${sutra.title}
                        ${sutra.subtitle ? `<span class="card-subtitle">${sutra.subtitle}</span>` : ''}
                    </h2>
                    <p class="card-description">${sutra.description}</p>
                    <div class="card-meta">
                        <span class="meta-time">${sutra.estimatedTime}</span>
                        <span class="meta-length">${sutra.length}ì</span>
                    </div>
                `;

                fragment.appendChild(card);
            });

            // Batch update
            requestAnimationFrame(() => {
                container.appendChild(fragment);
            });
        }

        // Filter sutras by category
        function filterSutras(category) {
            // Update active tab
            document.querySelectorAll('.tab-btn').forEach(btn => {
                const isActive = btn.dataset.category === category;
                btn.classList.toggle('active', isActive);
                btn.setAttribute('aria-selected', isActive ? 'true' : 'false');
            });

            // Render filtered cards
            renderSutraCards(category);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', async () => {
            // Wait for data to load first
            try {
                await dataLoadedPromise;
                console.log('Sutra data loaded, rendering cards...');

                // Render initial cards
                renderSutraCards('all');

                // Add event listeners to tab buttons
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        filterSutras(btn.dataset.category);
                    });
                });
            } catch (error) {
                console.error('Failed to load sutra data:', error);
                const container = document.getElementById('sutra-card-container');
                container.innerHTML = '<p style="color: red; text-align: center;">ê²½ì „ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.</p>';
            }
        });
    </script>
    <script type="module" src="js/sutra.js"></script>
    <script src="js/feedback.js"></script>
</body>
</html>
