<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>전자 사경 | Buddha Korea</title>
    <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/sutra.css">
</head>
<body>
    <!-- 접근성: 건너뛰기 링크 -->
    <a href="#screen-select" class="skip-link">사경 선택으로 건너뛰기</a>

    <!-- 헤더 -->
    <header class="site-header">
        <div class="header-container">
            <a href="index.html" class="header-logo">
                <img src="assets/buddha-line.png" alt="Buddha Korea" class="logo-icon">
                <span class="logo-text">Buddha Korea</span>
            </a>
            <nav class="header-nav">
                <a href="index.html" class="nav-link">홈</a>
                <div class="nav-dropdown">
                    <button class="nav-link dropdown-toggle" id="ai-nav-button">AI</button>
                    <div class="dropdown-menu">
                        <a href="https://notebooklm.google.com/notebook/1f5450ac-8ba6-4c30-b1ce-f63977dabfc1" target="_blank" class="dropdown-item">아비담마 AI</a>
                        <a href="https://notebooklm.google.com/notebook/18c4a48e-3225-4ddc-abe8-42515c19cbba" target="_blank" class="dropdown-item">청정도론 AI</a>
                        <a href="https://notebooklm.google.com/notebook/de2a2db1-e57e-428b-903b-43e75506833f" target="_blank" class="dropdown-item">초기불교 AI</a>
                    </div>
                </div>
                <a href="sutra-writing.html" class="nav-link">사경</a>
                <a href="meditation.html" class="nav-link">명상</a>
                <a href="teaching.html" class="nav-link">교학</a>
            </nav>
        </div>
    </header>
    <div class="header-spacer"></div>

    <!-- 마우스 따라다니는 빛 효과 -->
    <div class="mouse-light"></div>

    <!-- 메인 컨테이너 -->
    <div class="sutra-page">

        <!-- 1. 경전 선택 화면 -->
        <div id="screen-select" class="screen show">
            <div class="center-box">
                <h1>전자 사경</h1>
                <p class="subtitle">한 글자 한 글자 정성스럽게 타이핑하며 마음을 가다듬는 수행</p>

                <!-- Category tabs -->
                <div class="category-tabs" role="tablist" aria-label="사경 카테고리">
                    <button class="tab-btn active"
                            role="tab"
                            aria-selected="true"
                            aria-controls="sutra-card-container"
                            data-category="all">
                        전체
                    </button>
                    <button class="tab-btn"
                            role="tab"
                            aria-selected="false"
                            aria-controls="sutra-card-container"
                            data-category="sutra">
                        경전
                    </button>
                    <button class="tab-btn"
                            role="tab"
                            aria-selected="false"
                            aria-controls="sutra-card-container"
                            data-category="mantra">
                        진언
                    </button>
                    <button class="tab-btn"
                            role="tab"
                            aria-selected="false"
                            aria-controls="sutra-card-container"
                            data-category="name">
                        명호
                    </button>
                    <button class="tab-btn"
                            role="tab"
                            aria-selected="false"
                            aria-controls="sutra-card-container"
                            data-category="verse">
                        게송
                    </button>
                </div>

                <!-- Dynamic sutra cards container -->
                <div id="sutra-card-container"
                     class="sutra-cards"
                     role="tabpanel"
                     aria-live="polite"
                     aria-atomic="false">
                    <!-- Cards will be dynamically generated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- 2. 사경 작성 화면 -->
        <div id="screen-write" class="screen">
            <div class="write-container">
                <button class="back-btn" onclick="goBack()" aria-label="경전 선택 화면으로 돌아가기">← 돌아가기</button>

                <h2 id="sutra-name" class="sutra-name">자애경</h2>

                <!-- 타이핑 박스 -->
                <div class="type-box" role="region" aria-label="사경 작성 영역">
                    <div id="text-bg" class="text-bg" aria-live="polite" aria-atomic="false"></div>
                    <textarea id="text-input" class="text-input"
                              aria-label="경전 타이핑 입력창"
                              aria-describedby="sutra-name"></textarea>
                </div>

                <!-- 회향 버튼들 (완성 후 나타남) -->
                <div id="dedication-box" class="dedication-box" role="region" aria-labelledby="dedication-heading">
                    <h3 id="dedication-heading">공덕을 회향합니다</h3>
                    <p>이 작은 수행의 공덕을 모든 중생과 함께 나눕니다</p>

                    <div class="realm-buttons">
                        <button onclick="dedicate('hell')" aria-label="지옥 중생에게 공덕 회향">지옥 중생</button>
                        <button onclick="dedicate('animal')" aria-label="축생에게 공덕 회향">축생</button>
                        <button onclick="dedicate('hungry-ghost')" aria-label="아귀에게 공덕 회향">아귀</button>
                        <button onclick="dedicate('asura')" aria-label="아수라에게 공덕 회향">아수라</button>
                        <button onclick="dedicate('human')" aria-label="인간에게 공덕 회향">인간</button>
                        <button onclick="dedicate('deva')" aria-label="천신에게 공덕 회향">천신</button>
                        <button class="primary" onclick="dedicate('all')" aria-label="일체 중생에게 공덕 회향">일체 중생</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. 회향 완료 화면 -->
        <div id="screen-dedication-complete" class="screen">
            <div class="center-box">
                <h2 class="dedication-complete-text">회향 완료</h2>
            </div>
        </div>

    </div>

    <script type="module">
        import { getSutrasByCategory, getCategoryLabel } from './js/sutra-data.js';

        // Render sutra cards based on category filter
        function renderSutraCards(category = 'all') {
            const container = document.getElementById('sutra-card-container');
            const sutras = getSutrasByCategory(category);

            // Clear existing cards
            container.innerHTML = '';

            // Create fragment for better performance
            const fragment = document.createDocumentFragment();

            sutras.forEach(sutra => {
                const card = document.createElement('div');
                card.className = 'card';
                card.setAttribute('role', 'button');
                card.setAttribute('tabindex', '0');
                card.setAttribute('aria-label', `${sutra.title} 선택: ${sutra.description}`);

                // Event handlers
                card.onclick = () => window.selectSutra(sutra.id);
                card.onkeypress = (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        window.selectSutra(sutra.id);
                    }
                };

                // Card content
                card.innerHTML = `
                    <h2>
                        ${sutra.title}
                        ${sutra.subtitle ? `<span class="card-subtitle">${sutra.subtitle}</span>` : ''}
                    </h2>
                    <p class="card-description">${sutra.description}</p>
                    <div class="card-meta">
                        <span class="meta-time">${sutra.estimatedTime}</span>
                        <span class="meta-length">${sutra.length}자</span>
                    </div>
                `;

                fragment.appendChild(card);
            });

            // Batch update
            requestAnimationFrame(() => {
                container.appendChild(fragment);
            });
        }

        // Filter sutras by category
        function filterSutras(category) {
            // Update active tab
            document.querySelectorAll('.tab-btn').forEach(btn => {
                const isActive = btn.dataset.category === category;
                btn.classList.toggle('active', isActive);
                btn.setAttribute('aria-selected', isActive ? 'true' : 'false');
            });

            // Render filtered cards
            renderSutraCards(category);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Render initial cards
            renderSutraCards('all');

            // Add event listeners to tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    filterSutras(btn.dataset.category);
                });
            });
        });
    </script>
    <script type="module" src="js/sutra.js"></script>
</body>
</html>
