<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>불교 AI | CBETA 대장경 탐색기</title>
    <meta name="description" content="99,723개 CBETA 대장경을 AI와 함께 탐험하세요. Gemini 2.5 Pro 기반 RAG 시스템.">

    <!-- Preload Fonts -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css" rel="stylesheet">

    <!-- Library CSS -->
    <link rel="stylesheet" href="css/library.css">

    <style>
        /* ===== CSS Variables ===== */
        :root {
            /* Colors */
            --primary: #a794e0;
            --primary-light: #c4b8f0;
            --secondary: #89b8ff;
            --accent: #9bebb4;
            --gold: #daa520;

            /* Backgrounds */
            --bg-dark: #0a0e1a;
            --bg-medium: #12162d;
            --bg-light: #1a1f3d;
            --bg-card: rgba(26, 31, 61, 0.8);

            /* Glass */
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(167, 148, 224, 0.15);
            --glass-blur: blur(20px);

            /* Text */
            --text-primary: rgba(255, 255, 255, 0.95);
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-muted: rgba(255, 255, 255, 0.5);

            /* Typography */
            --font-main: 'Pretendard Variable', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;

            /* Spacing */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-2xl: 48px;
            --space-3xl: 64px;

            /* Transitions */
            --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
            --transition-fast: 0.2s var(--ease-out);
            --transition-normal: 0.3s var(--ease-out);
            --transition-slow: 0.5s var(--ease-out);

            /* Layout */
            --max-width: 800px;
            --header-height: 60px;
            --tab-bar-height: 80px;
        }

        /* ===== Reset ===== */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-main);
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            min-height: 100dvh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* ===== Ambient Background ===== */
        .ambient-bg {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .ambient-orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(100px);
            opacity: 0.15;
            animation: float 30s ease-in-out infinite;
        }

        .ambient-orb-1 {
            width: 600px;
            height: 600px;
            background: var(--primary);
            top: -300px;
            right: -200px;
        }

        .ambient-orb-2 {
            width: 500px;
            height: 500px;
            background: var(--secondary);
            bottom: -250px;
            left: -150px;
            animation-delay: -10s;
        }

        .ambient-orb-3 {
            width: 400px;
            height: 400px;
            background: var(--accent);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation-delay: -20s;
            opacity: 0.08;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(50px, -30px) scale(1.05); }
            50% { transform: translate(-30px, 50px) scale(0.95); }
            75% { transform: translate(-50px, -20px) scale(1.02); }
        }

        /* ===== App Container ===== */
        .app {
            position: relative;
            z-index: 1;
            min-height: 100vh;
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
        }

        /* ===== Hero Section ===== */
        .hero {
            min-height: 100vh;
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: var(--space-xl);
            position: relative;
        }

        .hero-content {
            max-width: 600px;
            animation: fadeUp 0.8s var(--ease-out);
        }

        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .hero-icon {
            font-size: 4rem;
            margin-bottom: var(--space-lg);
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.9; }
        }

        .hero-title {
            font-size: clamp(2rem, 6vw, 3rem);
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: var(--space-md);
            letter-spacing: -0.02em;
        }

        .hero-subtitle {
            font-size: clamp(1rem, 3vw, 1.25rem);
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: var(--space-2xl);
        }

        .hero-stats {
            display: flex;
            justify-content: center;
            gap: var(--space-xl);
            margin-bottom: var(--space-2xl);
            flex-wrap: wrap;
        }

        .hero-stat {
            text-align: center;
        }

        .hero-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gold);
        }

        .hero-stat-label {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin-top: var(--space-xs);
        }

        /* ===== CTA Buttons ===== */
        .hero-cta {
            display: flex;
            gap: var(--space-md);
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: var(--space-2xl);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-md) var(--space-xl);
            border-radius: 100px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-fast);
            border: none;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 4px 20px rgba(167, 148, 224, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(167, 148, 224, 0.5);
        }

        .btn-secondary {
            background: var(--glass-bg);
            color: var(--text-primary);
            border: 1px solid var(--glass-border);
            backdrop-filter: var(--glass-blur);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--primary);
        }

        /* ===== Sample Questions ===== */
        .sample-questions {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-sm);
            justify-content: center;
            max-width: 500px;
        }

        .sample-question {
            padding: var(--space-sm) var(--space-md);
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 100px;
            font-size: 0.875rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .sample-question:hover {
            background: rgba(167, 148, 224, 0.15);
            border-color: var(--primary);
            color: var(--text-primary);
        }

        /* ===== Scroll Indicator ===== */
        .scroll-indicator {
            position: absolute;
            bottom: var(--space-xl);
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-sm);
            color: var(--text-muted);
            font-size: 0.75rem;
            animation: bounce 2s ease-in-out infinite;
            cursor: pointer;
            padding: var(--space-md);
            border-radius: 12px;
            transition: var(--transition-fast);
        }

        .scroll-indicator:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }

        .scroll-indicator:hover svg {
            stroke: var(--primary);
        }

        @keyframes bounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(8px); }
        }

        .scroll-indicator svg {
            width: 24px;
            height: 24px;
            stroke: var(--text-muted);
            transition: var(--transition-fast);
        }

        /* ===== Chat Section ===== */
        .chat-section {
            flex: 1;
            display: none;
            flex-direction: column;
            padding-bottom: var(--tab-bar-height);
        }

        .chat-section.active {
            display: flex;
        }

        .chat-header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(10, 14, 26, 0.9);
            backdrop-filter: var(--glass-blur);
            border-bottom: 1px solid var(--glass-border);
            padding: var(--space-md) var(--space-lg);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-header-title {
            font-size: 1.125rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .chat-header-actions {
            display: flex;
            gap: var(--space-sm);
        }

        .icon-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-fast);
        }

        .icon-btn:hover {
            background: rgba(255, 255, 255, 0.08);
            color: var(--text-primary);
        }

        /* ===== Chat Container ===== */
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-lg);
            padding-bottom: 160px; /* Space for fixed input container + chips */
            max-width: var(--max-width);
            margin: 0 auto;
            width: 100%;
        }

        .chat-messages {
            display: flex;
            flex-direction: column;
            gap: var(--space-lg);
        }

        /* ===== Message Bubbles ===== */
        .message {
            display: flex;
            gap: var(--space-md);
            animation: messageIn 0.3s var(--ease-out);
        }

        @keyframes messageIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .message.assistant .message-avatar {
            background: var(--bg-light);
            border: 1px solid var(--glass-border);
        }

        .message-content {
            flex: 1;
            min-width: 0;
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-xs);
        }

        .message-sender {
            font-weight: 600;
            font-size: 0.875rem;
        }

        .message-time {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .message-text {
            background: var(--bg-card);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            border-top-left-radius: 4px;
            padding: var(--space-md);
            line-height: 1.7;
            color: var(--text-primary);
        }

        .message.user .message-text {
            background: rgba(167, 148, 224, 0.15);
            border-color: rgba(167, 148, 224, 0.3);
            border-top-left-radius: 16px;
            border-top-right-radius: 4px;
        }

        /* ===== Sources in Message ===== */
        .message-sources {
            margin-top: var(--space-md);
            padding-top: var(--space-md);
            border-top: 1px solid var(--glass-border);
        }

        .message-sources-title {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: var(--space-sm);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .message-source-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-xs);
        }

        .source-tag {
            padding: var(--space-xs) var(--space-sm);
            background: rgba(218, 165, 32, 0.1);
            border: 1px solid rgba(218, 165, 32, 0.3);
            border-radius: 100px;
            font-size: 0.75rem;
            color: var(--gold);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .source-tag:hover {
            background: rgba(218, 165, 32, 0.2);
        }

        /* ===== Chat Options (Chips) ===== */
        .chat-options {
            display: flex;
            gap: var(--space-sm);
            flex-wrap: wrap;
            margin-bottom: var(--space-md);
        }

        .chat-option-group {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .chat-option-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-right: var(--space-xs);
        }

        .chat-chip {
            padding: 6px 12px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 100px;
            font-size: 0.8125rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition-fast);
            font-family: inherit;
            white-space: nowrap;
        }

        .chat-chip:hover {
            background: rgba(167, 148, 224, 0.1);
            border-color: var(--primary);
            color: var(--text-primary);
        }

        .chat-chip.active {
            background: rgba(167, 148, 224, 0.2);
            border-color: var(--primary);
            color: var(--primary);
        }

        .chat-chip-icon {
            margin-right: 4px;
        }

        /* Divider between option groups */
        .chat-option-divider {
            width: 1px;
            height: 20px;
            background: var(--glass-border);
            margin: 0 var(--space-sm);
        }

        /* ===== Chat Input ===== */
        .chat-input-container {
            position: fixed;
            bottom: var(--tab-bar-height);
            left: 0;
            right: 0;
            padding: var(--space-md) var(--space-lg);
            background: linear-gradient(to top, var(--bg-dark) 80%, transparent);
            z-index: 90;
        }

        .chat-input-wrapper {
            max-width: var(--max-width);
            margin: 0 auto;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .chat-input-row {
            position: relative;
            display: flex;
            align-items: center;
        }

        .chat-input {
            width: 100%;
            padding: var(--space-md) var(--space-xl);
            padding-right: 60px;
            background: var(--bg-card);
            border: 2px solid var(--glass-border);
            border-radius: 24px;
            font-size: 1rem;
            color: var(--text-primary);
            outline: none;
            transition: var(--transition-fast);
            font-family: inherit;
            resize: none;
        }

        .chat-input::placeholder {
            color: var(--text-muted);
        }

        .chat-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(167, 148, 224, 0.15);
        }

        .chat-send-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-fast);
            flex-shrink: 0;
        }

        .chat-send-btn:hover {
            transform: translateY(-50%) scale(1.05);
        }

        .chat-input-row .chat-send-btn {
            position: absolute;
            right: 8px;
        }

        .chat-send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .chat-send-btn svg {
            width: 20px;
            height: 20px;
        }

        /* ===== Chat Welcome ===== */
        .chat-welcome {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: var(--space-2xl) var(--space-lg);
            min-height: 50vh;
            animation: fadeUp 0.5s var(--ease-out);
        }

        .chat-welcome-icon {
            font-size: 3rem;
            margin-bottom: var(--space-lg);
            opacity: 0.8;
        }

        .chat-welcome-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: var(--space-md);
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .chat-welcome-desc {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: var(--space-xl);
        }

        .chat-welcome-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-sm);
            justify-content: center;
            max-width: 400px;
        }

        .welcome-suggestion {
            padding: var(--space-sm) var(--space-md);
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 100px;
            font-size: 0.875rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition-fast);
            font-family: inherit;
        }

        .welcome-suggestion:hover {
            background: rgba(167, 148, 224, 0.15);
            border-color: var(--primary);
            color: var(--text-primary);
        }

        /* ===== Typing Indicator ===== */
        .typing-indicator {
            display: none;
            gap: var(--space-xs);
            padding: var(--space-md);
            background: var(--bg-card);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            width: fit-content;
        }

        .typing-indicator.active {
            display: flex;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--text-muted);
            border-radius: 50%;
            animation: typingBounce 1.4s ease-in-out infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingBounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-6px); }
        }

        /* ===== Tab Bar (Mobile) ===== */
        .tab-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: var(--tab-bar-height);
            background: rgba(10, 14, 26, 0.95);
            backdrop-filter: var(--glass-blur);
            border-top: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding-bottom: env(safe-area-inset-bottom);
            z-index: 1000;
        }

        .tab-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-xs);
            padding: var(--space-sm) var(--space-md);
            color: var(--text-muted);
            cursor: pointer;
            transition: var(--transition-fast);
            -webkit-tap-highlight-color: transparent;
        }

        .tab-item.active {
            color: var(--primary);
        }

        .tab-item:hover {
            color: var(--text-primary);
        }

        .tab-icon {
            width: 24px;
            height: 24px;
        }

        .tab-label {
            font-size: 0.75rem;
            font-weight: 500;
        }

        /* ===== Library Section ===== */
        .library-section {
            display: none;
            flex-direction: column;
            min-height: 100vh;
            padding-bottom: var(--tab-bar-height);
        }

        .library-section.active {
            display: flex;
        }

        /* ===== Methodology Section ===== */
        .methodology-section {
            display: none;
            flex-direction: column;
            min-height: 100vh;
            padding: var(--space-lg);
            padding-bottom: calc(var(--tab-bar-height) + var(--space-lg));
        }

        .methodology-section.active {
            display: flex;
        }

        .methodology-header {
            text-align: center;
            margin-bottom: var(--space-2xl);
        }

        .methodology-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: var(--space-sm);
        }

        .methodology-subtitle {
            color: var(--text-secondary);
        }

        .methodology-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--space-lg);
            max-width: 1000px;
            margin: 0 auto;
        }

        .method-card {
            background: var(--bg-card);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: var(--space-lg);
            transition: var(--transition-fast);
        }

        .method-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .method-card-icon {
            font-size: 2rem;
            margin-bottom: var(--space-md);
        }

        .method-card-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: var(--space-sm);
        }

        .method-card-desc {
            color: var(--text-secondary);
            line-height: 1.6;
            font-size: 0.9375rem;
        }

        .method-badge {
            display: inline-block;
            margin-top: var(--space-md);
            padding: var(--space-xs) var(--space-sm);
            background: rgba(218, 165, 32, 0.1);
            border: 1px solid rgba(218, 165, 32, 0.3);
            border-radius: 100px;
            font-size: 0.75rem;
            color: var(--gold);
        }

        /* ===== Desktop Navigation ===== */
        .desktop-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: rgba(10, 14, 26, 0.95);
            backdrop-filter: var(--glass-blur);
            border-bottom: 1px solid var(--glass-border);
            display: none;
            align-items: center;
            justify-content: space-between;
            padding: 0 var(--space-xl);
            z-index: 1000;
            transform: translateY(-100%);
            transition: transform var(--transition-normal);
        }

        .desktop-nav.visible {
            transform: translateY(0);
        }

        .desktop-nav-brand {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .desktop-nav-brand:hover {
            color: var(--primary);
        }

        .desktop-nav-links {
            display: flex;
            gap: var(--space-xs);
        }

        .desktop-nav-link {
            padding: var(--space-sm) var(--space-md);
            border-radius: 8px;
            font-size: 0.9375rem;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition-fast);
            border: none;
            background: transparent;
        }

        .desktop-nav-link:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }

        .desktop-nav-link.active {
            background: rgba(167, 148, 224, 0.15);
            color: var(--primary);
        }

        /* ===== Responsive ===== */
        @media (min-width: 768px) {
            .tab-bar {
                display: none;
            }

            .desktop-nav {
                display: flex;
            }

            .chat-section, .library-section, .methodology-section {
                padding-bottom: 0;
                padding-top: var(--header-height);
            }

            /* Hide chat header on desktop - use desktop nav instead */
            .chat-header {
                display: none;
            }

            .chat-input-container {
                bottom: 0;
            }
        }

        @media (max-width: 767px) {
            .hero {
                padding: var(--space-lg);
            }

            .hero-stats {
                gap: var(--space-lg);
            }

            .btn {
                padding: var(--space-sm) var(--space-lg);
                font-size: 0.9375rem;
            }

            .sample-questions {
                max-width: 100%;
            }

            /* More padding on mobile for input + chips + tab bar */
            .chat-container {
                padding-bottom: 220px;
            }

            /* Stack chips vertically on small screens */
            .chat-options {
                flex-direction: column;
                gap: var(--space-xs);
            }

            .chat-option-divider {
                display: none;
            }

            .chat-option-group {
                width: 100%;
                justify-content: flex-start;
            }
        }

        /* ===== Utilities ===== */
        .hidden {
            display: none !important;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }
    </style>
</head>
<body>
    <!-- Ambient Background -->
    <div class="ambient-bg">
        <div class="ambient-orb ambient-orb-1"></div>
        <div class="ambient-orb ambient-orb-2"></div>
        <div class="ambient-orb ambient-orb-3"></div>
    </div>

    <!-- Desktop Navigation -->
    <nav class="desktop-nav" id="desktopNav">
        <div class="desktop-nav-brand" onclick="goHome()">
            <span>&#x2638;</span>
            <span>불교 AI</span>
        </div>
        <div class="desktop-nav-links">
            <button class="desktop-nav-link active" data-tab="chat" onclick="switchTab('chat')">채팅</button>
            <button class="desktop-nav-link" data-tab="library" onclick="switchTab('library')">라이브러리</button>
            <button class="desktop-nav-link" data-tab="methodology" onclick="switchTab('methodology')">방법론</button>
        </div>
    </nav>

    <!-- App -->
    <div class="app">
        <!-- Hero Section -->
        <section class="hero" id="hero">
            <div class="hero-content">
                <div class="hero-icon">&#x2638;</div>
                <h1 class="hero-title">불교 AI 대장경 탐색기</h1>
                <p class="hero-subtitle">
                    99,723개 CBETA 대장경을<br>
                    AI와 함께 탐험하세요
                </p>

                <div class="hero-stats">
                    <div class="hero-stat">
                        <div class="hero-stat-value">99,723</div>
                        <div class="hero-stat-label">경전 청크</div>
                    </div>
                    <div class="hero-stat">
                        <div class="hero-stat-value">2,459</div>
                        <div class="hero-stat-label">경전 수</div>
                    </div>
                    <div class="hero-stat">
                        <div class="hero-stat-value">Gemini</div>
                        <div class="hero-stat-label">2.5 Pro</div>
                    </div>
                </div>

                <div class="hero-cta">
                    <button class="btn btn-primary" onclick="startChat()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                        </svg>
                        질문하기
                    </button>
                    <button class="btn btn-secondary" onclick="switchTab('library')">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                        </svg>
                        경전 둘러보기
                    </button>
                </div>

                <div class="sample-questions">
                    <button class="sample-question" onclick="askQuestion('사성제란 무엇인가요?')">사성제란?</button>
                    <button class="sample-question" onclick="askQuestion('팔정도의 각 요소를 설명해주세요')">팔정도란?</button>
                    <button class="sample-question" onclick="askQuestion('무아의 개념을 설명해주세요')">무아란?</button>
                    <button class="sample-question" onclick="askQuestion('연기법이란 무엇인가요?')">연기법이란?</button>
                </div>
            </div>

            <div class="scroll-indicator" title="클릭하여 시작">
                <span>클릭하여 시작하기</span>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 5v14M19 12l-7 7-7-7"/>
                </svg>
            </div>
        </section>

        <!-- Chat Section -->
        <section class="chat-section" id="chatSection">
            <header class="chat-header">
                <div class="chat-header-title">
                    <span>&#x2638;</span>
                    <span>불교 AI</span>
                </div>
                <div class="chat-header-actions">
                    <button class="icon-btn" onclick="clearChat()" title="새 대화">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 5v14M5 12h14"/>
                        </svg>
                    </button>
                </div>
            </header>

            <div class="chat-container" id="chatContainer">
                <div class="chat-messages" id="chatMessages">
                    <!-- Welcome Message -->
                    <div class="chat-welcome" id="chatWelcome">
                        <div class="chat-welcome-icon">&#x2638;</div>
                        <h2 class="chat-welcome-title">불교 AI에 오신 것을 환영합니다</h2>
                        <p class="chat-welcome-desc">
                            99,723개의 CBETA 대장경을 기반으로<br>
                            불교에 대한 질문에 답변해 드립니다.
                        </p>
                        <div class="chat-welcome-suggestions">
                            <button class="welcome-suggestion" onclick="askQuestion('사성제란 무엇인가요?')">사성제란?</button>
                            <button class="welcome-suggestion" onclick="askQuestion('팔정도를 설명해주세요')">팔정도란?</button>
                            <button class="welcome-suggestion" onclick="askQuestion('무아의 개념이란?')">무아란?</button>
                            <button class="welcome-suggestion" onclick="askQuestion('연기법이란 무엇인가요?')">연기법이란?</button>
                        </div>
                    </div>
                </div>

                <div class="typing-indicator" id="typingIndicator">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>

            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <!-- Chat Options (Chips) -->
                    <div class="chat-options">
                        <div class="chat-option-group">
                            <span class="chat-option-label">응답</span>
                            <button class="chat-chip active" data-mode="normal" onclick="setResponseMode('normal')">일반</button>
                            <button class="chat-chip" data-mode="detailed" onclick="setResponseMode('detailed')">상세</button>
                            <button class="chat-chip" data-mode="academic" onclick="setResponseMode('academic')">학술적</button>
                        </div>
                        <div class="chat-option-divider"></div>
                        <div class="chat-option-group">
                            <span class="chat-option-label">경전</span>
                            <button class="chat-chip active" data-tradition="all" onclick="setTraditionFilter('all')">전체</button>
                            <button class="chat-chip" data-tradition="초기불교" onclick="setTraditionFilter('초기불교')">초기불교</button>
                            <button class="chat-chip" data-tradition="대승불교" onclick="setTraditionFilter('대승불교')">대승불교</button>
                            <button class="chat-chip" data-tradition="선불교" onclick="setTraditionFilter('선불교')">선불교</button>
                        </div>
                    </div>
                    <div class="chat-input-row">
                        <input
                            type="text"
                            class="chat-input"
                            id="chatInput"
                            placeholder="불교에 대해 무엇이든 물어보세요..."
                            autocomplete="off"
                        >
                        <button class="chat-send-btn" id="sendBtn" onclick="sendMessage()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Library Section -->
        <section class="library-section" id="librarySection">
            <div id="libraryOverlay" class="library-overlay active" style="position: relative; display: flex; opacity: 1;">
                <div class="library-container" id="libraryContainer" style="pointer-events: auto;">
                    <div class="library-header">
                        <div class="library-header-top">
                            <h2 id="libraryTitle">경전 라이브러리</h2>
                        </div>
                        <div class="library-search-bar">
                            <input type="text" id="librarySearch" placeholder="경전 제목, 내용 검색..." oninput="handleSearchInput()">
                        </div>
                        <div class="library-filters library-filters-desktop">
                            <select id="libraryThemeFilter" onchange="filterLibraryCards()">
                                <option value="">모든 주제</option>
                            </select>
                            <select id="libraryTraditionFilter" onchange="filterLibraryCards()">
                                <option value="">모든 전통</option>
                            </select>
                            <button class="filter-reset-btn" onclick="resetAllFilters()">초기화</button>
                        </div>
                        <button class="mobile-filter-btn" onclick="openMobileFilters()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 21v-7M4 10V3M12 21v-9M12 8V3M20 21v-5M20 12V3M1 14h6M9 8h6M17 16h6"/>
                            </svg>
                            필터
                            <span class="filter-count" id="mobileFilterCount" style="display:none;">0</span>
                        </button>
                        <div id="libraryFilterBadges" class="library-filter-badges"></div>
                        <div class="library-results-count" id="libraryResultsCount">
                            전체 <span>0</span>개 경전
                        </div>
                    </div>
                    <div id="libraryLoading" class="library-loading" style="display: none;">
                        <div class="loading-spinner"></div>
                        <p>경전을 불러오는 중...</p>
                    </div>
                    <div id="libraryEmpty" class="library-empty" style="display: none;">
                        <div class="empty-icon">&#128218;</div>
                        <h3>검색 결과가 없습니다</h3>
                        <p>다른 검색어나 필터를 시도해보세요</p>
                    </div>
                    <div class="library-grid" id="libraryGrid"></div>
                </div>
            </div>
        </section>

        <!-- Methodology Section -->
        <section class="methodology-section" id="methodologySection">
            <div class="methodology-header">
                <h2 class="methodology-title">우리의 방법론</h2>
                <p class="methodology-subtitle">CBETA 대장경부터 AI 답변까지, 전체 프로세스</p>
            </div>

            <div class="methodology-grid">
                <div class="method-card">
                    <div class="method-card-icon">&#128218;</div>
                    <h3 class="method-card-title">CBETA 대정신수대장경</h3>
                    <p class="method-card-desc">전자불전문화재단(CBETA)의 대정신수대장경(T) 컬렉션을 사용합니다.</p>
                    <div class="method-badge">99,723개 청크</div>
                </div>

                <div class="method-card">
                    <div class="method-card-icon">&#128203;</div>
                    <h3 class="method-card-title">Gemini 임베딩</h3>
                    <p class="method-card-desc">Google Gemini embedding-001로 모든 경전을 3072차원 벡터로 변환했습니다.</p>
                    <div class="method-badge">3072-dim</div>
                </div>

                <div class="method-card">
                    <div class="method-card-icon">&#128269;</div>
                    <h3 class="method-card-title">RAG 검색</h3>
                    <p class="method-card-desc">질문과 의미가 유사한 경전 구절을 밀리초 단위로 검색합니다.</p>
                    <div class="method-badge">Top 10-20 검색</div>
                </div>

                <div class="method-card">
                    <div class="method-card-icon">&#129302;</div>
                    <h3 class="method-card-title">Gemini 2.5 Pro</h3>
                    <p class="method-card-desc">2M 토큰 컨텍스트로 여러 경전을 종합 분석하여 답변합니다.</p>
                    <div class="method-badge">2M 토큰</div>
                </div>
            </div>
        </section>
    </div>

    <!-- Mobile Tab Bar -->
    <nav class="tab-bar" id="tabBar">
        <div class="tab-item active" onclick="switchTab('chat')" data-tab="chat">
            <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
            </svg>
            <span class="tab-label">채팅</span>
        </div>
        <div class="tab-item" onclick="switchTab('library')" data-tab="library">
            <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
            </svg>
            <span class="tab-label">라이브러리</span>
        </div>
        <div class="tab-item" onclick="switchTab('methodology')" data-tab="methodology">
            <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 16v-4M12 8h.01"/>
            </svg>
            <span class="tab-label">방법론</span>
        </div>
    </nav>

    <!-- Mobile Filter Drawer -->
    <div class="mobile-filter-drawer" id="mobileFilterDrawer">
        <div class="drawer-backdrop" onclick="closeMobileFilters()"></div>
        <div class="drawer-content">
            <div class="drawer-handle"></div>
            <div class="drawer-header">
                <h3>필터</h3>
                <button class="drawer-close" onclick="closeMobileFilters()">&times;</button>
            </div>
            <div class="drawer-body">
                <div class="drawer-filter-group">
                    <label>주제</label>
                    <select id="mobileThemeFilter" onchange="syncMobileFilter('theme')">
                        <option value="">모든 주제</option>
                    </select>
                </div>
                <div class="drawer-filter-group">
                    <label>전통</label>
                    <select id="mobileTraditionFilter" onchange="syncMobileFilter('tradition')">
                        <option value="">모든 전통</option>
                    </select>
                </div>
            </div>
            <div class="drawer-footer">
                <button class="drawer-reset-btn" onclick="resetAllFilters(); closeMobileFilters();">초기화</button>
                <button class="drawer-apply-btn" onclick="closeMobileFilters()">적용</button>
            </div>
        </div>
    </div>

    <!-- Library JavaScript -->
    <script src="js/library.js"></script>

    <!-- Main JavaScript -->
    <script>
        // ===== State =====
        let currentTab = 'hero';
        let isHeroVisible = true;
        let allSources = [];

        // Chat options state
        let chatOptions = {
            responseMode: 'normal',  // normal, detailed, academic
            traditionFilter: 'all'   // all, 초기불교, 대승불교, 선불교
        };

        // ===== Chat Options Functions =====
        function setResponseMode(mode) {
            chatOptions.responseMode = mode;
            // Update chip UI
            document.querySelectorAll('.chat-chip[data-mode]').forEach(chip => {
                chip.classList.toggle('active', chip.dataset.mode === mode);
            });
        }

        function setTraditionFilter(tradition) {
            chatOptions.traditionFilter = tradition;
            // Update chip UI
            document.querySelectorAll('.chat-chip[data-tradition]').forEach(chip => {
                chip.classList.toggle('active', chip.dataset.tradition === tradition);
            });
        }

        // ===== Tab Navigation =====
        function switchTab(tab) {
            // Hide hero
            document.getElementById('hero').classList.add('hidden');
            isHeroVisible = false;

            // Show desktop navigation
            document.getElementById('desktopNav').classList.add('visible');

            // Update sections
            document.querySelectorAll('.chat-section, .library-section, .methodology-section').forEach(s => {
                s.classList.remove('active');
            });

            // Activate selected section
            if (tab === 'chat') {
                document.getElementById('chatSection').classList.add('active');
            } else if (tab === 'library') {
                document.getElementById('librarySection').classList.add('active');
                // Trigger library load if needed
                if (typeof loadInitialCards === 'function' && typeof libraryState !== 'undefined' && libraryState.cards.length === 0) {
                    loadInitialCards();
                }
            } else if (tab === 'methodology') {
                document.getElementById('methodologySection').classList.add('active');
            }

            // Update mobile tab bar
            document.querySelectorAll('.tab-item').forEach(item => {
                item.classList.toggle('active', item.dataset.tab === tab);
            });

            // Update desktop nav links
            document.querySelectorAll('.desktop-nav-link').forEach(link => {
                link.classList.toggle('active', link.dataset.tab === tab);
            });

            currentTab = tab;
        }

        // ===== Go Home =====
        function goHome() {
            // Hide all sections
            document.querySelectorAll('.chat-section, .library-section, .methodology-section').forEach(s => {
                s.classList.remove('active');
            });

            // Show hero
            document.getElementById('hero').classList.remove('hidden');
            isHeroVisible = true;

            // Hide desktop nav
            document.getElementById('desktopNav').classList.remove('visible');

            // Reset tab states
            document.querySelectorAll('.tab-item, .desktop-nav-link').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector('.tab-item[data-tab="chat"]')?.classList.add('active');
            document.querySelector('.desktop-nav-link[data-tab="chat"]')?.classList.add('active');

            currentTab = 'hero';

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ===== Start Chat =====
        function startChat() {
            switchTab('chat');
            document.getElementById('chatInput').focus();
        }

        // ===== Ask Sample Question =====
        function askQuestion(question) {
            switchTab('chat');
            document.getElementById('chatInput').value = question;
            sendMessage();
        }

        // ===== Chat Functions =====
        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();

            if (!message) return;

            // Add user message
            addMessage('user', message);
            input.value = '';

            // Show typing indicator
            document.getElementById('typingIndicator').classList.add('active');

            try {
                // Build request based on chat options
                const requestBody = {
                    query: message,
                    detailed: chatOptions.responseMode === 'detailed' || chatOptions.responseMode === 'academic'
                };

                // Add tradition filter if not 'all'
                if (chatOptions.traditionFilter !== 'all') {
                    requestBody.tradition_filter = chatOptions.traditionFilter;
                }

                // Add academic mode hint to query if selected
                let enhancedQuery = message;
                if (chatOptions.responseMode === 'academic') {
                    enhancedQuery = `[학술적 관점에서 상세히 설명해주세요] ${message}`;
                    requestBody.query = enhancedQuery;
                }

                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) throw new Error('Chat request failed');

                const data = await response.json();

                // Hide typing indicator
                document.getElementById('typingIndicator').classList.remove('active');

                // Add assistant message (API returns 'response' not 'answer')
                addMessage('assistant', data.response, data.sources);

            } catch (error) {
                console.error('Chat error:', error);
                document.getElementById('typingIndicator').classList.remove('active');
                addMessage('assistant', '죄송합니다. 오류가 발생했습니다. 다시 시도해주세요.');
            }
        }

        function addMessage(role, text, sources = []) {
            const messages = document.getElementById('chatMessages');
            const time = new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });

            // Hide welcome message on first message
            const welcome = document.getElementById('chatWelcome');
            if (welcome) {
                welcome.style.display = 'none';
            }

            const sourceHtml = sources.length > 0 ? `
                <div class="message-sources">
                    <div class="message-sources-title">참고 경전</div>
                    <div class="message-source-tags">
                        ${sources.map(s => `<span class="source-tag" onclick="showSourceDetail('${s.text_id}')">${s.title || s.text_id}</span>`).join('')}
                    </div>
                </div>
            ` : '';

            const html = `
                <div class="message ${role}">
                    <div class="message-avatar">${role === 'user' ? '&#128100;' : '&#x2638;'}</div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-sender">${role === 'user' ? '나' : '불교 AI'}</span>
                            <span class="message-time">${time}</span>
                        </div>
                        <div class="message-text">${formatMessage(text)}${sourceHtml}</div>
                    </div>
                </div>
            `;

            messages.insertAdjacentHTML('beforeend', html);

            // Scroll to bottom
            const container = document.getElementById('chatContainer');
            container.scrollTop = container.scrollHeight;
        }

        function formatMessage(text) {
            // Handle null/undefined
            if (!text) return '';

            // Basic markdown-like formatting
            return String(text)
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/\n/g, '<br>');
        }

        function clearChat() {
            document.getElementById('chatMessages').innerHTML = `
                <div class="chat-welcome" id="chatWelcome">
                    <div class="chat-welcome-icon">&#x2638;</div>
                    <h2 class="chat-welcome-title">불교 AI에 오신 것을 환영합니다</h2>
                    <p class="chat-welcome-desc">
                        99,723개의 CBETA 대장경을 기반으로<br>
                        불교에 대한 질문에 답변해 드립니다.
                    </p>
                    <div class="chat-welcome-suggestions">
                        <button class="welcome-suggestion" onclick="askQuestion('사성제란 무엇인가요?')">사성제란?</button>
                        <button class="welcome-suggestion" onclick="askQuestion('팔정도를 설명해주세요')">팔정도란?</button>
                        <button class="welcome-suggestion" onclick="askQuestion('무아의 개념이란?')">무아란?</button>
                        <button class="welcome-suggestion" onclick="askQuestion('연기법이란 무엇인가요?')">연기법이란?</button>
                    </div>
                </div>
            `;
        }

        // ===== Keyboard Events =====
        document.getElementById('chatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // ===== Load Metadata =====
        async function loadMetadata() {
            try {
                const response = await fetch('/api/sutras/meta');
                if (!response.ok) throw new Error('Failed to load metadata');

                const metadata = await response.json();

                // Populate library filters
                if (typeof window.onLibraryMetadataLoaded === 'function') {
                    window.onLibraryMetadataLoaded(metadata);
                }

                // Store globally
                window.libraryMetadata = metadata;

                console.log('Metadata loaded:', metadata.total, 'sources');
            } catch (error) {
                console.error('Error loading metadata:', error);
            }
        }

        // ===== Initialize =====
        document.addEventListener('DOMContentLoaded', () => {
            loadMetadata();

            // Scroll indicator click handler
            const scrollIndicator = document.querySelector('.scroll-indicator');
            if (scrollIndicator) {
                scrollIndicator.style.cursor = 'pointer';
                scrollIndicator.addEventListener('click', () => {
                    startChat();
                });
            }

            // Intersection observer for hero
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (!entry.isIntersecting && isHeroVisible) {
                        // User scrolled past hero - could auto-switch to chat
                    }
                });
            }, { threshold: 0.1 });

            observer.observe(document.getElementById('hero'));
        });
    </script>
</body>
</html>
